@page "/campaigns"
@inject HttpClient Http
<h3>Campanhas</h3>
<input @bind="search" placeholder="Pesquisar..." />
<label style="margin-left:8px"><input type="checkbox" @bind="recruitingOnly" /> Apenas recrutando</label>
<button class="btn" @onclick="Load" style="margin-left:8px">Buscar</button>

<ul>
    @if (campaigns is null)
    {
        <li>Carregando...</li>
    }
    else if (campaigns.Count == 0)
    {
        <li>Nenhuma campanha encontrada.</li>
    }
    else
    {
        @foreach (var c in campaigns)
        {
            <li>
                <b>@c.Name</b> — @c.Status — @(c.IsRecruiting ? "Recrutando" : "Fechada")
                <a href="/campaigns/@c.Id" style="margin-left:8px">ver</a>
            </li>
        }
    }
</ul>

@code {
    private string? search;
    private bool recruitingOnly = true;
    private List<Campaign>? campaigns;

    protected override async Task OnInitializedAsync() => await Load();

    private async Task Load()
    {
        var url = $"/api/campaigns?search={Uri.EscapeDataString(search ?? string.Empty)}&recruitingOnly={recruitingOnly}";
        campaigns = await Http.GetFromJsonAsync<List<Campaign>>(url) ?? new();
    }
}
